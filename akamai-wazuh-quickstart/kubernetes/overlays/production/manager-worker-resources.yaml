# ============================================================================
# Akamai Cloud Wazuh Quick-Start - Manager Worker Resource Limits
# ============================================================================
# Resource limits for Wazuh Manager Worker nodes
#   - Handles agent events (port 1514)
#   - Processes security data
#   - Performs analysis and correlation
#   - Scales horizontally for more agents
# ============================================================================

---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: wazuh-manager-worker
  namespace: wazuh
spec:
  # Number of worker replicas
  replicas: 2

  template:
    spec:
      containers:
        - name: wazuh-manager
          resources:
            requests:
              memory: "1Gi"
              cpu: "500m"
            limits:
              memory: "2Gi"
              cpu: "1000m"

          # Environment variables for tuning
          env:
            # Worker-specific configuration
            - name: WORKER_NODE
              value: "yes"

          # Liveness probe
          livenessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - /var/ossec/bin/wazuh-control status | grep -q "wazuh-analysisd is running"
            initialDelaySeconds: 90
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 3

          # Readiness probe
          readinessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - /var/ossec/bin/wazuh-control status | grep -q "wazuh-analysisd is running"
            initialDelaySeconds: 60
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3

  # Volume claim templates for persistent storage
  volumeClaimTemplates:
    - metadata:
        name: wazuh-manager-worker
      spec:
        accessModes:
          - ReadWriteOnce
        storageClassName: linode-block-storage-retain
        resources:
          requests:
            storage: 50Gi
